import streamlit as st
import pandas as pd
import plotly.graph_objects as go

# --- ãƒšãƒ¼ã‚¸è¨­å®š ---
st.set_page_config(
    page_title="Partnership Health Check",
    page_icon="â¤ï¸",
    layout="centered"
)

# --- ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° (èª­ã¿ã‚„ã™ã•å‘ä¸Š) ---
st.markdown("""
<style>
    .report-box {
        background-color: #f0f2f6;
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #ff4b4b;
        margin-bottom: 20px;
    }
    .strength-box {
        background-color: #e8f5e9;
        padding: 15px;
        border-radius: 10px;
        border-left: 5px solid #4caf50;
        margin-bottom: 10px;
    }
</style>
""", unsafe_allow_html=True)

st.title("â¤ï¸ Partnership Health Check")
st.caption("Produced by Non-chan / Life Strategist")

st.markdown("""
ã‚ãªãŸã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã®çŠ¶æ…‹ã‚’**ã€Œ8ã¤ã®æŒ‡æ¨™ã€**ã‹ã‚‰å¤šè§’çš„ã«åˆ†æã—ã¾ã™ã€‚  
ç¾åœ¨ã®æ„Ÿè¦šã«æœ€ã‚‚è¿‘ã„æ•°å€¤ã‚’ã€ç›´æ„Ÿã§é¸ã‚“ã§ãã ã•ã„ã€‚
""")

st.divider()

# --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  ---
with st.form("check_form"):
    
    st.subheader("â… . è¨€èªçš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Verbal)")
    st.info("è¨€è‘‰ã«ã‚ˆã‚‹ã€Œæ„æ€è¡¨ç¤ºã€ã¨ã€Œå—å®¹ã€ã®ãƒãƒ©ãƒ³ã‚¹")
    col1, col2 = st.columns(2)
    with col1:
        q1 = st.slider("Q1. ã€ç™ºä¿¡ï¼šå¿«ã€‘ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦æœ›ã‚’ä¼ãˆã¦ã„ã‚‹", 0, 10, 5)
        q2 = st.slider("Q2. ã€ç™ºä¿¡ï¼šä¸å¿«ã€‘å«Œãªã“ã¨ã‚’å†·é™ã«ä¼ãˆã¦ã„ã‚‹", 0, 10, 5)
    with col2:
        q3 = st.slider("Q3. ã€å—ä¿¡ï¼šå¿«ã€‘ç›¸æ‰‹ã®å¤¢ã‚„å¸Œæœ›ã‚’èã„ã¦ã„ã‚‹", 0, 10, 5)
        q4 = st.slider("Q4. ã€å—ä¿¡ï¼šä¸å¿«ã€‘ç›¸æ‰‹ã®NOã‚’å—ã‘æ­¢ã‚ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¡. éè¨€èªãƒ»èº«ä½“ (Non-Verbal & Physical)")
    st.info("äºŒäººã®é–“ã«æµã‚Œã‚‹ã€Œç©ºæ°—æ„Ÿã€ã¨ã€Œä½“æ¸©ã€")
    q5 = st.slider("Q5. ã€ç©ºæ°—æ„Ÿã€‘å®‰å¿ƒã§ãã‚‹ç©ºæ°—ãƒ»è¡¨æƒ…ã‚’ä½œã£ã¦ã„ã‚‹", 0, 10, 5)
    q6 = st.slider("Q6. ã€ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ã€‘è‚Œã®æ¸©ã‚‚ã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¢. è¡Œå‹•çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Action)")
    st.info("ç›¸æ‰‹ã®ãŸã‚ã«ã€Œã™ã‚‹ã“ã¨ã€ã¨ã€ŒãŸã å±…ã‚‹ã“ã¨ã€")
    q7 = st.slider("Q7. ã€èƒ½å‹•çš„è²¢çŒ®(Doing)ã€‘ç›¸æ‰‹ã®ãŸã‚ã®è¡Œå‹•ã‚’ã—ã¦ã„ã‚‹", 0, 10, 5)
    q8 = st.slider("Q8. ã€å—å‹•çš„å…±æœ‰(Being)ã€‘ä½•ã‚‚ã—ãªã„æ™‚é–“ã‚’å…±æœ‰ã§ãã¦ã„ã‚‹", 0, 10, 5)

    submitted = st.form_submit_button("æ·±å±¤è¨ºæ–­ã‚’å®Ÿè¡Œã™ã‚‹", type="primary")

# --- è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•° (Updated Tone) ---
def analyze_results(q1, q2, q3, q4, q5, q6, q7, q8):
    diagnosis = []
    
    # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    self_assert = (q1 + q2) / 2  # è‡ªå·±ä¸»å¼µåŠ›
    receptivity = (q3 + q4) / 2  # å—å®¹åŠ›
    
    # 1. è‡ªå·±çŠ ç‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ (è²¢çŒ®é«˜ã„ + NOè¨€ãˆãªã„)
    if q7 >= 7 and q2 <= 4:
        diagnosis.append({
            "title": "âš ï¸ ã€éƒ½åˆã®è‰¯ã„ã‚®ãƒãƒ¼ã€è­¦å ±",
            "text": """
            ã‚ãªãŸã¯ç›¸æ‰‹ã®ãŸã‚ã«ä¸€ç”Ÿæ‡¸å‘½å°½ãã—ã¦ã„ã¾ã™ãŒï¼ˆQ7é«˜ï¼‰ã€è‡ªåˆ†ã‚’å®ˆã‚‹ãŸã‚ã®ã€ŒNOï¼ˆQ2ï¼‰ã€ãŒè¨€ãˆã¦ã„ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ã“ã‚Œã¯ã€Œæ„›ã•ã‚ŒãŸã„ã‹ã‚‰å°½ãã™ã€ã¨ã„ã†å–å¼•ã«ãªã‚ŠãŒã¡ã§ã€é•·æœŸçš„ã«ã¯ã‚ãªãŸãŒç–²å¼Šã—ã¦ã—ã¾ã†ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** ä»Šæ—¥ã¯ã‚ãˆã¦ã€Œå®¶äº‹ã‚’ã‚µãƒœã‚‹ã€ã‹ã€å°ã•ãªé ¼ã¿äº‹ã‚’ã€Œæ–­ã‚‹ã€ç·´ç¿’ã‚’ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ æ„›ã¯åŠ´åƒã®å¯¾ä¾¡ã§ã¯ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãƒãƒ£ãƒ³ã‚¹ã§ã™ã€‚
            """
        })

    # 2. ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ (ç™ºä¿¡å¼·ã„ + å—ä¿¡å¼±ã„)
    if self_assert >= 7 and receptivity <= 4:
        diagnosis.append({
            "title": "âš ï¸ ã€ä¸€æ–¹é€šè¡Œã®å¸ä»¤å¡”ã€çŠ¶æ…‹",
            "text": """
            è‡ªåˆ†ã®è¦æœ›ã¯æ˜ç¢ºã«ä¼ãˆã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚’å—ã‘å–ã‚‹ã‚¢ãƒ³ãƒ†ãƒŠãŒé–‰ã˜ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¯ã€Œã©ã†ã›è¨€ã£ã¦ã‚‚ç„¡é§„ã ã€ã¨è«¦ã‚ã€å¿ƒã‚’é–‰ã–ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** æ¬¡ã®ä¼šè©±ã§ã¯ã€è‡ªåˆ†ã®æ„è¦‹ã‚’è¨€ã†å‰ã«ã€Œ3ç§’ã€æ•°ãˆã¦ã€ç›¸æ‰‹ã«ã€Œã‚ãªãŸã¯ã©ã†æ€ã†ï¼Ÿã€ã¨ãƒã‚¤ã‚¯ã‚’æ¸¡ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            """
        })

    # 3. è‰¯ã„å­ã¡ã‚ƒã‚“ãƒ‘ã‚¿ãƒ¼ãƒ³ (YESè¨€ãˆã‚‹ + NOè¨€ãˆãªã„)
    if q1 >= 7 and q2 <= 4:
        diagnosis.append({
            "title": "ğŸ­ ã€ç„¡é‚ªæ°—ãªæ¼”æŠ€è€…ã€å‚¾å‘",
            "text": """
            æ¥½ã—ã„ã“ã¨ã‚„å¥½ããªã“ã¨ã¯å…±æœ‰ã§ãã¦ã„ã¾ã™ãŒã€ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ„Ÿæƒ…ã‚’éš ã—ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ
            ã€Œå–§å˜©ã—ãŸããªã„ã‹ã‚‰ã€ã¨é£²ã¿è¾¼ã‚“ã è¨€è‘‰ã¯ã€ä½“å†…ã§æ¯’ã«å¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** ã€Œå®Ÿã¯ã‚ã®æ™‚ã€ã¡ã‚‡ã£ã¨æ‚²ã—ã‹ã£ãŸã‚“ã ã€ã¨ã€éå»ã®å‡ºæ¥äº‹ã§ã‚‚ã„ã„ã®ã§ã€Œå°ã•ãªä¸å¿«ã€ã‚’é–‹ç¤ºã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ ãã‚ŒãŒæœ¬å½“ã®ä¿¡é ¼ã‚’ä½œã‚‹ç¬¬ä¸€æ­©ã§ã™ã€‚
            """
        })
        
    # 4. ãƒ«ãƒ¼ãƒ ã‚·ã‚§ã‚¢ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ (Beingé«˜ã„ + Skinshipä½ã„)
    if q8 >= 7 and q6 <= 3:
        diagnosis.append({
            "title": "ğŸ  ã€åŒå±…äººåŒ–ã€ã‚·ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ ",
            "text": """
            ä¸€ç·’ã«ã„ã¦æ¥½ãªé–¢ä¿‚ã§ã™ãŒã€ç”·å¥³ã¨ã—ã¦ã®ã¨ãã‚ãã‚„è¦ªå¯†ã•ãŒå¤±ã‚ã‚Œã¤ã¤ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ã€Œå®¶æ—ã€ã¨ã—ã¦ã¯æ©Ÿèƒ½ã—ã¦ã„ã¦ã‚‚ã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦ã®çµåˆãŒå¼±ã¾ã£ã¦ã„ã¾ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** æ¥­å‹™é€£çµ¡ã§ã¯ãªã„ã€æ„å‘³ã®ãªã„ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ã‚’å–ã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ æ‰‹ã‚’ã¤ãªãã ã‘ã§ã‚‚ã€ã‚ªã‚­ã‚·ãƒˆã‚·ãƒ³ã¯åˆ†æ³Œã•ã‚Œã¾ã™ã€‚
            """
        })

    # 5. å®Œå…¨ãƒãƒ©ãƒ³ã‚¹å‹ (Mature)
    if min([q1, q2, q3, q4, q5, q6, q7, q8]) >= 7:
        diagnosis.append({
            "title": "ğŸ‘‘ ã€æˆç†Ÿã—ãŸãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã€",
            "text": """
            ç´ æ™´ã‚‰ã—ã„ãƒãƒ©ãƒ³ã‚¹ã§ã™ï¼è‡ªç«‹ã—ãŸäºŒäººãŒã€äº’ã„ã«ä¾å­˜ã—åˆãˆã‚‹ç†æƒ³çš„ãªçŠ¶æ…‹ã§ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** ã“ã®è‰¯ã„çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€æ”¹ã‚ã¦æ„Ÿè¬ã®è¨€è‘‰ã‚’ä¼ãˆåˆã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            """
        })
    
    # 6. ãƒ”ãƒ³ãƒåˆ¤å®š (å…¨ä½“çš„ã«ä½ã„)
    if (q1+q2+q3+q4+q5+q6+q7+q8)/8 <= 4:
        diagnosis.append({
            "title": "ğŸ†˜ ã€ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ãŒå¿…è¦",
            "text": """
            å…¨ä½“çš„ã«ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚ãŠãã‚‰ãã€ãŠäº’ã„ã«ç–²ã‚Œåˆ‡ã£ã¦ã„ã‚‹ã‹ã€è«¦ã‚ãŒç”Ÿã˜ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ä»Šã¯ç„¡ç†ã«ã€Œæ”¹å–„ã€ã‚„ã€Œè­°è«–ã€ã‚’ã—ã‚ˆã†ã¨ã›ãšã€ã¾ãšã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼è£œçµ¦ãŒå¿…è¦ã§ã™ã€‚
            **å‡¦æ–¹ç®‹ï¼š** è­°è«–ã¯ä¸€æ—¦ç¦æ­¢ã—ã¦ã€ãŸã ä¸€ç·’ã«ç¾å‘³ã—ã„ã‚±ãƒ¼ã‚­ã‚’é£Ÿã¹ã‚‹æ™‚é–“ã‚’ä½œã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            """
        })

    return diagnosis

# --- çµæœè¡¨ç¤º ---
if submitted:
    st.divider()
    
    # ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
    labels = ['ç™ºä¿¡:å¿«', 'ç™ºä¿¡:ä¸å¿«', 'å—ä¿¡:å¿«', 'å—ä¿¡:ä¸å¿«', 'ç©ºæ°—æ„Ÿ', 'ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—', 'è²¢çŒ®(Doing)', 'å…±æœ‰(Being)']
    values = [q1, q2, q3, q4, q5, q6, q7, q8]
    values_radar = values + [values[0]]
    labels_radar = labels + [labels[0]]

    fig = go.Figure()
    fig.add_trace(go.Scatterpolar(
        r=values_radar, theta=labels_radar, fill='toself', name='Score',
        line_color='#FF4B4B', fillcolor='rgba(255, 75, 75, 0.2)'
    ))
    fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[0, 10])), showlegend=False)
    st.plotly_chart(fig, use_container_width=True)

    # --- æ·±å±¤è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ ---
    st.header("ğŸ“‹ Diagnostic Report")
    
    # ç·åˆã‚¹ã‚³ã‚¢
    total_score = sum(values)
    st.markdown(f"### Total Score: **{total_score}** / 80")

    # è¨ºæ–­çµæœã®å–å¾—
    results = analyze_results(q1, q2, q3, q4, q5, q6, q7, q8)
    
    if len(results) > 0:
        for res in results:
            st.markdown(f"""
            <div class="report-box">
                <h4>{res['title']}</h4>
                <p>{res['text']}</p>
            </div>
            """, unsafe_allow_html=True)
    else:
        # ç‰¹å¾´çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªã„å ´åˆã®æ±ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        st.info("ç‰¹ç­†ã™ã¹ãæ¥µç«¯ãªãƒãƒ©ãƒ³ã‚¹ã®å´©ã‚Œã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®å‡¹ã‚“ã§ã„ã‚‹éƒ¨åˆ†ãŒã€æ¬¡ã®ä¼¸ã³ä»£ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚")

    # --- å¼·ã¿(è³‡ç”£)ã®ç™ºè¦‹ ---
    st.subheader("ğŸ’ Your Relationship Assets")
    assets = []
    if q1 >= 8: assets.append("ã‚ãªãŸã®ã€Œç´ ç›´ãªè¦æœ›ã€ã¯ã€äºŒäººã®æ¨é€²åŠ›ã§ã™ã€‚")
    if q3 >= 8: assets.append("ã‚ãªãŸã®ã€ŒèãåŠ›ã€ãŒã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®è‡ªå·±è‚¯å®šæ„Ÿã‚’æ”¯ãˆã¦ã„ã¾ã™ã€‚")
    if q5 >= 8: assets.append("ã‚ãªãŸãŒä½œã‚‹ã€Œç©ºæ°—æ„Ÿã€ã¯ã€æœ€é«˜ã®å®‰å…¨åŸºåœ°ã§ã™ã€‚")
    if q8 >= 8: assets.append("ã€Œæ²ˆé»™ã‚’å…±æœ‰ã§ãã‚‹ã€é–¢ä¿‚ã¯ã€é•·ç¶šãã™ã‚‹ã‚«ãƒƒãƒ—ãƒ«ã®è¨¼ã§ã™ã€‚")
    
    if assets:
        for asset in assets:
            st.markdown(f'<div class="strength-box">âœ¨ {asset}</div>', unsafe_allow_html=True)