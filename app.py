import streamlit as st
import pandas as pd
import plotly.graph_objects as go

# --- ãƒšãƒ¼ã‚¸è¨­å®š ---
st.set_page_config(
    page_title="Partnership Health Check",
    page_icon="â¤ï¸",
    layout="centered"
)

# --- ã‚¿ã‚¤ãƒˆãƒ«ã¨å°å…¥ ---
st.title("â¤ï¸ Partnership Health Check")
st.caption("Produced by Non-chan / Life Strategist")

st.markdown("""
ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã®çŠ¶æ…‹ã‚’**8ã¤ã®è¦–ç‚¹**ã§æ•°å€¤åŒ–ã—ã€é–¢ä¿‚ã®ã€Œå¥åº·çŠ¶æ…‹ã€ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚  
ç›´æ„Ÿã§ **0ç‚¹ï¼ˆå…¨ããã†æ€ã‚ãªã„ï¼‰ã€œ 10ç‚¹ï¼ˆéå¸¸ã«å¼·ããã†æ€ã†ï¼‰** ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
""")

st.divider()

# --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  ---
with st.form("check_form"):
    
    st.subheader("â… . è¨€èªçš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Verbal)")
    st.info("è¨€è‘‰ã«ã‚ˆã‚‹ã€Œæ„æ€è¡¨ç¤ºã€ã¨ã€Œå—å®¹ã€ã®ãƒãƒ©ãƒ³ã‚¹")
    
    q1 = st.slider("Q1. ã€ç™ºä¿¡ï¼šå¿«ã€‘ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦æœ›ï¼ˆå¥½ããƒ»ã—ãŸã„ï¼‰ã‚’ä¼ãˆã¦ã„ã‚‹", 0, 10, 5)
    q2 = st.slider("Q2. ã€ç™ºä¿¡ï¼šä¸å¿«ã€‘ãƒã‚¬ãƒ†ã‚£ãƒ–ãªä¸»å¼µï¼ˆå«Œãƒ»ã‚„ã‚ã¦ï¼‰ã‚’å†·é™ã«ä¼ãˆã¦ã„ã‚‹", 0, 10, 5, help="æˆ‘æ…¢ã›ãšã«ã€ã‹ã¤æ”»æ’ƒçš„ã«ãªã‚‰ãšã«è¨€ãˆã¦ã„ã¾ã™ã‹ï¼Ÿ")
    q3 = st.slider("Q3. ã€å—ä¿¡ï¼šå¿«ã€‘ç›¸æ‰‹ã®ã€Œå¤¢ã€ã‚„ã€Œã‚„ã‚ŠãŸã„ã“ã¨ã€ã‚’ç©æ¥µçš„ã«èã„ã¦ã„ã‚‹", 0, 10, 5, help="ç›¸æ‰‹ã®äººç”Ÿã«é–¢å¿ƒã‚’æŒã¦ã¦ã„ã¾ã™ã‹ï¼Ÿ")
    q4 = st.slider("Q4. ã€å—ä¿¡ï¼šä¸å¿«ã€‘ç›¸æ‰‹ã®ã€ŒNOã€ã‚„æ–­ã‚Šã‚’ã€ä¸æ©Ÿå«Œã«ãªã‚‰ãšå—ã‘æ­¢ã‚ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¡. éè¨€èªãƒ»èº«ä½“ (Non-Verbal & Physical)")
    st.info("äºŒäººã®é–“ã«æµã‚Œã‚‹ã€Œç©ºæ°—æ„Ÿã€ã¨ã€Œä½“æ¸©ã€")
    
    q5 = st.slider("Q5. ã€ç©ºæ°—æ„Ÿã€‘ç›¸æ‰‹ãŒè©±ã—ã‚„ã™ã„ã€Œå®‰å¿ƒã§ãã‚‹ç©ºæ°—ãƒ»è¡¨æƒ…ã€ã‚’ä½œã£ã¦ã„ã‚‹", 0, 10, 5)
    q6 = st.slider("Q6. ã€ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ã€‘æ—¥å¸¸çš„ã«æ‰‹ã‚’ã¤ãªãç­‰ã®è‚Œã®æ¸©ã‚‚ã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¢. è¡Œå‹•çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Action)")
    st.info("ç›¸æ‰‹ã®ãŸã‚ã«ã€Œã™ã‚‹ã“ã¨ã€ã¨ã€ŒãŸã å±…ã‚‹ã“ã¨ã€")
    
    q7 = st.slider("Q7. ã€èƒ½å‹•çš„è²¢çŒ®(Doing)ã€‘å®¶äº‹ã‚„ã‚µãƒãƒ¼ãƒˆãªã©ã€ç›¸æ‰‹ã®ãŸã‚ã®è¡Œå‹•ã‚’ã—ã¦ã„ã‚‹", 0, 10, 5)
    q8 = st.slider("Q8. ã€å—å‹•çš„å…±æœ‰(Being)ã€‘ä½•ã‚‚ã—ãªã„æ™‚é–“ã‚’å¿ƒåœ°ã‚ˆãå…±æœ‰ã§ãã¦ã„ã‚‹", 0, 10, 5, help="æ²ˆé»™ã¯æ€–ããªã„ã§ã™ã‹ï¼Ÿ")

    submitted = st.form_submit_button("è¨ºæ–­çµæœã‚’è¡¨ç¤ºã™ã‚‹", type="primary")

# --- çµæœè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ ---
if submitted:
    st.divider()
    st.header("ğŸ“Š Diagnosis Result")

    # ãƒ‡ãƒ¼ã‚¿ã®æ•´ç†
    labels = [
        'ç™ºä¿¡:å¿«(Q1)', 'ç™ºä¿¡:ä¸å¿«(Q2)', 
        'å—ä¿¡:å¿«(Q3)', 'å—ä¿¡:ä¸å¿«(Q4)',
        'ç©ºæ°—æ„Ÿ(Q5)', 'ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—(Q6)', 
        'è²¢çŒ®(Doing)(Q7)', 'å…±æœ‰(Being)(Q8)'
    ]
    values = [q1, q2, q3, q4, q5, q6, q7, q8]
    
    # ãƒãƒ£ãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹å‡¦ç†
    values_radar = values + [values[0]]
    labels_radar = labels + [labels[0]]

    # ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”»
    fig = go.Figure()
    fig.add_trace(go.Scatterpolar(
        r=values_radar,
        theta=labels_radar,
        fill='toself',
        name='Your Score',
        line_color='#FF4B4B',
        fillcolor='rgba(255, 75, 75, 0.3)'
    ))

    fig.update_layout(
        polar=dict(
            radialaxis=dict(
                visible=True,
                range=[0, 10],  # 0-10å›ºå®š
                tickfont=dict(size=10),
            )
        ),
        showlegend=False,
        margin=dict(l=40, r=40, t=40, b=40)
    )

    st.plotly_chart(fig, use_container_width=True)

    # --- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚³ãƒ¡ãƒ³ãƒˆ ---
    st.subheader("ğŸ’¡ Strategic Advice")

    # ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®—
    total_score = sum(values)
    avg_score = total_score / 8

    col1, col2 = st.columns(2)
    with col1:
        st.metric("Total Score", f"{total_score} / 80")
    with col2:
        st.metric("Average", f"{avg_score:.1f}")

    # å€‹åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    advice_list = []

    # Q2 (NOã‚’è¨€ã†åŠ›) ãŒä½ã„å ´åˆ
    if q2 <= 5:
        advice_list.append("âš ï¸ **ã€ŒNOã€ã‚’è¨€ã†å‹‡æ°—ãŒå¿…è¦ã§ã™**\nä¸å¿«ãªã“ã¨ã‚’æˆ‘æ…¢ã™ã‚‹ã¨ã€ã„ã¤ã‹çˆ†ç™ºã—ã¦ã—ã¾ã„ã¾ã™ã€‚å°ã•ãªã€Œãã‚Œã¯å«Œã€ã‚’ä¼ãˆã‚‹ç·´ç¿’ã‚’ã—ã¾ã—ã‚‡ã†ã€‚")

    # Q3 (ç›¸æ‰‹ã¸ã®é–¢å¿ƒ) ãŒä½ã„å ´åˆ
    if q3 <= 5:
        advice_list.append("âš ï¸ **ç›¸æ‰‹ã¸ã®ã€Œå¥½å¥‡å¿ƒã€ãŒä¸è¶³æ°—å‘³ï¼Ÿ**\nè‡ªåˆ†ã®ã“ã¨ã§æ‰‹ä¸€æ¯ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã€Œæœ€è¿‘ã©ã†ï¼Ÿã€ã¨ç›¸æ‰‹ã®å¤¢ã«ã¤ã„ã¦èã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚")

    # ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„å ´åˆ
    if avg_score >= 8 and (max(values) - min(values) <= 3):
        advice_list.append("ğŸŒŸ **ç´ æ™´ã‚‰ã—ã„ãƒãƒ©ãƒ³ã‚¹ã§ã™ï¼**\nãŠäº’ã„ãŒè‡ªç«‹ã—ã¤ã¤ä¾å­˜ã§ãã¦ã„ã‚‹ã€éå¸¸ã«å¥åº·çš„ãªçŠ¶æ…‹ã§ã™ã€‚")
    
    # Q7ãŒé«˜ãã¦Q8ãŒä½ã„å ´åˆ (å°½ãã—ã™ã)
    if q7 >= 7 and q8 <= 4:
        advice_list.append("â˜• **ã€Œä½•ã‚‚ã—ãªã„ã€ç·´ç¿’ã‚’**\nå½¹ã«ç«‹ã¨ã†ã¨é ‘å¼µã‚Šã™ãã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ ãŸã æ¨ªã«åº§ã£ã¦ãƒ€ãƒ©ãƒ€ãƒ©ã™ã‚‹æ™‚é–“ã‚‚ã€ç«‹æ´¾ãªæ„›ã§ã™ã€‚")

    # ã‚¢ãƒ‰ãƒã‚¤ã‚¹è¡¨ç¤º
    if advice_list:
        for advice in advice_list:
            st.warning(advice) if "âš ï¸" in advice else st.info(advice)
    else:
        st.write("å…¨ä½“çš„ã«ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚æ°—ã«ãªã‚‹é …ç›®ãŒã‚ã‚Œã°ã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨è©±ã—åˆã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼")