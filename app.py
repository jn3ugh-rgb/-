import streamlit as st
import pandas as pd
import plotly.graph_objects as go

# --- ãƒšãƒ¼ã‚¸è¨­å®š ---
st.set_page_config(
    page_title="Partnership Health Check",
    page_icon="â¤ï¸",
    layout="centered"
)

# --- ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° (Dark Modeå¯¾å¿œç‰ˆ) ---
# æ–‡å­—è‰²(color)ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€èƒŒæ™¯ãŒé»’ããªã£ã¦ã‚‚è¦–èªæ€§ã‚’ä¿ã¤
st.markdown("""
<style>
    /* ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”¨ã®èµ¤ã„ç®± */
    .report-box {
        background-color: #f0f2f6;
        color: #31333F; /* æ–‡å­—è‰²ã‚’æ¿ƒã„ã‚°ãƒ¬ãƒ¼ã«å›ºå®š */
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #ff4b4b;
        margin-bottom: 20px;
    }
    /* å¼·ã¿ç”¨ã®ç·‘ã®ç®± */
    .strength-box {
        background-color: #e8f5e9;
        color: #1b5e20; /* æ–‡å­—è‰²ã‚’æ¿ƒã„ç·‘ã«å›ºå®š */
        padding: 15px;
        border-radius: 10px;
        border-left: 5px solid #4caf50;
        margin-bottom: 10px;
    }
    /* ã‚¿ã‚¤ãƒˆãƒ«ã‚„è¦‹å‡ºã—ã®å¾®èª¿æ•´ */
    h4 {
        margin-top: 0;
        color: #31333F;
    }
</style>
""", unsafe_allow_html=True)

st.title("â¤ï¸ Partnership Health Check")
st.caption("Produced by Non-chan / Life Strategist")

st.markdown("""
ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã®çŠ¶æ…‹ã‚’**ã€Œ8ã¤ã®æŒ‡æ¨™ã€**ã‹ã‚‰å¤šè§’çš„ã«åˆ†æã—ã¾ã™ã€‚  
**ã€Œä»Šã®äºŒäººã®çŠ¶æ…‹ã€** ã¨ã—ã¦ã€ç›´æ„Ÿçš„ã«æœ€ã‚‚è¿‘ã„æ„Ÿè¦šã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
""")

st.divider()

# --- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  ---
with st.form("check_form"):
    
    st.subheader("â… . è¨€èªçš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Verbal)")
    st.info("è¨€è‘‰ã«ã‚ˆã‚‹ã€Œæ„æ€è¡¨ç¤ºã€ã¨ã€Œå—å®¹ã€ã®ãƒãƒ©ãƒ³ã‚¹")
    col1, col2 = st.columns(2)
    with col1:
        q1 = st.slider("Q1. ã€ç™ºä¿¡ï¼šå¿«ã€‘ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦æœ›ï¼ˆå¥½ããƒ»ã—ãŸã„ï¼‰ã‚’ä¼ãˆã¦ã„ã‚‹", 0, 10, 5)
        q2 = st.slider("Q2. ã€ç™ºä¿¡ï¼šä¸å¿«ã€‘ãƒã‚¬ãƒ†ã‚£ãƒ–ãªä¸»å¼µï¼ˆå«Œãƒ»ã‚„ã‚ã¦ï¼‰ã‚’å†·é™ã«ä¼ãˆã¦ã„ã‚‹", 0, 10, 5)
    with col2:
        q3 = st.slider("Q3. ã€å—ä¿¡ï¼šå¿«ã€‘ç›¸æ‰‹ã®ã€Œå¤¢ã€ã‚„ã€Œã‚„ã‚ŠãŸã„ã“ã¨ã€ã«é–¢å¿ƒã‚’æŒã£ã¦ã„ã‚‹", 0, 10, 5)
        q4 = st.slider("Q4. ã€å—ä¿¡ï¼šä¸å¿«ã€‘ç›¸æ‰‹ã®ã€ŒNOã€ã‚„æ–­ã‚Šã‚’ã€ä¸æ©Ÿå«Œã«ãªã‚‰ãšå—ã‘æ­¢ã‚ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¡. éè¨€èªãƒ»èº«ä½“ (Non-Verbal & Physical)")
    st.info("äºŒäººã®é–“ã«æµã‚Œã‚‹ã€Œç©ºæ°—æ„Ÿã€ã¨ã€Œä½“æ¸©ã€")
    q5 = st.slider("Q5. ã€ç©ºæ°—æ„Ÿã€‘ç›¸æ‰‹ãŒè©±ã—ã‚„ã™ã„ã€Œå®‰å¿ƒã§ãã‚‹ç©ºæ°—ãƒ»è¡¨æƒ…ã€ã‚’ä½œã£ã¦ã„ã‚‹", 0, 10, 5)
    q6 = st.slider("Q6. ã€ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ã€‘æ—¥å¸¸çš„ã«æ‰‹ã‚’ã¤ãªãç­‰ã®è‚Œã®æ¸©ã‚‚ã‚Šã‚’å¤§åˆ‡ã«ã—ã¦ã„ã‚‹", 0, 10, 5)

    st.subheader("â…¢. è¡Œå‹•çš„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Action)")
    st.info("ç›¸æ‰‹ã®ãŸã‚ã«ã€Œã™ã‚‹ã“ã¨ã€ã¨ã€ŒãŸã å±…ã‚‹ã“ã¨ã€")
    q7 = st.slider("Q7. ã€èƒ½å‹•çš„è²¢çŒ®(Doing)ã€‘å®¶äº‹ã‚„ã‚µãƒãƒ¼ãƒˆãªã©ã€ç›¸æ‰‹ã®ãŸã‚ã®è¡Œå‹•ã‚’ã—ã¦ã„ã‚‹", 0, 10, 5)
    q8 = st.slider("Q8. ã€å—å‹•çš„å…±æœ‰(Being)ã€‘ä½•ã‚‚ã—ãªã„æ™‚é–“ã‚’å¿ƒåœ°ã‚ˆãå…±æœ‰ã§ãã¦ã„ã‚‹", 0, 10, 5)

    submitted = st.form_submit_button("åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹", type="primary")

# --- è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯é–¢æ•° (Updated Tone) ---
def analyze_results(q1, q2, q3, q4, q5, q6, q7, q8):
    diagnosis = []
    
    # ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    self_assert = (q1 + q2) / 2  # è‡ªå·±ä¸»å¼µåŠ›
    receptivity = (q3 + q4) / 2  # å—å®¹åŠ›
    
    # 1. è‡ªå·±çŠ ç‰²ãƒ‘ã‚¿ãƒ¼ãƒ³ (è²¢çŒ®é«˜ã„ + NOè¨€ãˆãªã„)
    if q7 >= 7 and q2 <= 4:
        diagnosis.append({
            "title": "âš ï¸ ã€å°½ãã—ã™ãã€ã®ã‚µã‚¤ãƒ³ãŒå‡ºã¦ã„ã¾ã™",
            "text": """
            ç›¸æ‰‹ã®ãŸã‚ã«ä¸€ç”Ÿæ‡¸å‘½å‹•ãå„ªã—ã•ã‚’æŒã£ã¦ã„ã¾ã™ãŒï¼ˆQ7é«˜ï¼‰ã€è‡ªåˆ†ã‚’å®ˆã‚‹ãŸã‚ã®ã€ŒNOï¼ˆQ2ï¼‰ã€ãŒå°‘ã—ä¸è¶³ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ã€Œæ„›ã•ã‚ŒãŸã„ã‹ã‚‰é ‘å¼µã‚‹ã€ã¨ã„ã†ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹ã¨ã€ã„ã¤ã‹å¿ƒãŒç–²ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
            **ğŸ’¡ Try this:** ä»Šæ—¥ã¯ã‚ãˆã¦ã€Œå°ã•ãªãƒ¯ã‚¬ãƒãƒã€ã‚’è¨€ã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ ã‚ãªãŸãŒé ‘å¼µã‚‰ãªãã¦ã‚‚ã€ã‚ãªãŸã®ä¾¡å€¤ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚
            """
        })

    # 2. ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ (ç™ºä¿¡å¼·ã„ + å—ä¿¡å¼±ã„)
    if self_assert >= 7 and receptivity <= 4:
        diagnosis.append({
            "title": "âš ï¸ ã€ä¸€æ–¹é€šè¡Œã€ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™",
            "text": """
            ã‚ãªãŸã®æƒ³ã„ã¯ã—ã£ã‹ã‚Šå±Šã„ã¦ã„ã¾ã™ãŒã€ç›¸æ‰‹ã‹ã‚‰ã®ãƒœãƒ¼ãƒ«ã‚’å—ã‘å–ã‚‹ã‚¢ãƒ³ãƒ†ãƒŠãŒå°‘ã—é–‰ã˜ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¯ã€Œã©ã†ã›è¨€ã£ã¦ã‚‚ç„¡é§„ã ã€ã¨ã€å£ã‚’ã¤ãã‚“ã§ã—ã¾ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ
            **ğŸ’¡ Try this:** æ¬¡ã®ä¼šè©±ã§ã¯ã€è‡ªåˆ†ã®æ„è¦‹ã‚’è¨€ã†å‰ã«ã€Œ3ç§’ã€å¾…ã£ã¦ã€ç›¸æ‰‹ã«ã€Œã‚ãªãŸã¯ã©ã†æ€ã†ï¼Ÿã€ã¨ãƒã‚¤ã‚¯ã‚’æ¸¡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
            """
        })

    # 3. è‰¯ã„å­ã¡ã‚ƒã‚“ãƒ‘ã‚¿ãƒ¼ãƒ³ (YESè¨€ãˆã‚‹ + NOè¨€ãˆãªã„)
    if q1 >= 7 and q2 <= 4:
        diagnosis.append({
            "title": "ğŸ­ ã€æœ¬å½“ã®è‡ªåˆ†ã€ã‚’éš ã—ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ",
            "text": """
            æ¥½ã—ã„ã“ã¨ã®å…±æœ‰ã¯ãƒãƒƒãƒãƒªã§ã™ï¼ã§ã‚‚ã€ã€Œå«Œã‚ã‚ŒãŸããªã„ã€ã¨ã„ã†æ€ã„ã‹ã‚‰ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ„Ÿæƒ…ã«è“‹ã‚’ã—ã¦ã„ã‚‹å‚¾å‘ãŒè¦‹ãˆã¾ã™ã€‚
            ã€Œå–§å˜©ã‚’é¿ã‘ã‚‹ã“ã¨ã€ã‚ˆã‚Šã€Œæœ¬éŸ³ã‚’çŸ¥ã‚‹ã“ã¨ã€ã®æ–¹ãŒã€äºŒäººã®çµ†ã‚’å¼·ãã—ã¾ã™ã€‚
            **ğŸ’¡ Try this:** ã€Œå®Ÿã¯ã‚ã®æ™‚ã€ã¡ã‚‡ã£ã¨å¯‚ã—ã‹ã£ãŸã‚“ã ã€ã¨ã€éå»ã®è©±ã§ã‚‚ã„ã„ã®ã§ã€Œå°ã•ãªå¼±éŸ³ã€ã‚’é–‹ç¤ºã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            """
        })
        
    # 4. ãƒ«ãƒ¼ãƒ ã‚·ã‚§ã‚¢ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ (Beingé«˜ã„ + Skinshipä½ã„)
    if q8 >= 7 and q6 <= 3:
        diagnosis.append({
            "title": "ğŸ  ã€åŒå±…äººã€ã®ã‚ˆã†ãªè·é›¢æ„Ÿã‹ã‚‚ï¼Ÿ",
            "text": """
            ä¸€ç·’ã«ã„ã¦æ°—ã‚’ä½¿ã‚ãªã„ã€ã¨ã¦ã‚‚æ¥½ãªé–¢ä¿‚ã§ã™ã€‚ãŸã ã€ç”·å¥³ã¨ã—ã¦ã®ã€Œã¨ãã‚ãã€ã‚„ã€Œè¦ªå¯†ã•ã€ãŒå°‘ã—å¾Œå›ã—ã«ãªã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
            æ©Ÿèƒ½çš„ãªãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚‚ç´ æ•µã§ã™ãŒã€æƒ…ç·’çš„ãªã¤ãªãŒã‚Šã‚‚å¤§åˆ‡ã§ã™ã€‚
            **ğŸ’¡ Try this:** æ¥­å‹™é€£çµ¡ã§ã¯ãªã„ã€æ„å‘³ã®ãªã„ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ã‚’å–ã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ æ‰‹ã‚’ã¤ãªãã ã‘ã§ã‚‚ã€å¹¸ã›ãƒ›ãƒ«ãƒ¢ãƒ³ï¼ˆã‚ªã‚­ã‚·ãƒˆã‚·ãƒ³ï¼‰ã¯åˆ†æ³Œã•ã‚Œã¾ã™ã€‚
            """
        })

    # 5. å®Œå…¨ãƒãƒ©ãƒ³ã‚¹å‹ (Mature)
    if min([q1, q2, q3, q4, q5, q6, q7, q8]) >= 7:
        diagnosis.append({
            "title": "ğŸ‘‘ ã€æˆç†Ÿã—ãŸãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã€ã§ã™",
            "text": """
            ç´ æ™´ã‚‰ã—ã„ãƒãƒ©ãƒ³ã‚¹ã§ã™ï¼ è‡ªç«‹ã—ãŸäºŒäººãŒã€äº’ã„ã«å°Šé‡ã—åˆã„ãªãŒã‚‰ä¾å­˜ã§ãã¦ã„ã‚‹ç†æƒ³çš„ãªçŠ¶æ…‹ã§ã™ã€‚
            **ğŸ’¡ Try this:** ã“ã®è‰¯ã„çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€æ”¹ã‚ã¦ã€Œã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã€ã¨è¨€è‘‰ã«ã—ã¦ä¼ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚
            """
        })
    
    # 6. ãƒ”ãƒ³ãƒåˆ¤å®š (å…¨ä½“çš„ã«ä½ã„)
    if (q1+q2+q3+q4+q5+q6+q7+q8)/8 <= 4:
        diagnosis.append({
            "title": "ğŸµ ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼è£œçµ¦ã€ãŒå¿…è¦ã§ã™",
            "text": """
            å…¨ä½“çš„ã«æ•°å€¤ãŒä½ã‚ã§ã™ã€‚ãŠäºŒäººã®ç›¸æ€§ãŒæ‚ªã„ã¨ã„ã†ã‚ˆã‚Šã€å˜ç´”ã«ã€Œç–²ã‚Œåˆ‡ã£ã¦ã„ã‚‹ã€å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            ä»Šã¯ç„¡ç†ã«è©±ã—åˆã„ã‚„æ”¹å–„ã‚’ã—ã‚ˆã†ã¨ã›ãšã€ã¾ãšã¯ä¼‘ã‚€ã“ã¨ãŒæœ€å„ªå…ˆã§ã™ã€‚
            **ğŸ’¡ Try this:** é›£ã—ã„è©±ã¯ä¸€æ—¦ç¦æ­¢ã«ã—ã¦ã€ãŸã ä¸€ç·’ã«ç¾å‘³ã—ã„ã‚±ãƒ¼ã‚­ã§ã‚‚é£Ÿã¹ã¦ã€æ—©ãå¯ã¾ã—ã‚‡ã†ã€‚
            """
        })

    return diagnosis

# --- çµæœè¡¨ç¤º ---
if submitted:
    st.divider()
    
    # ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
    labels = ['ç™ºä¿¡:å¿«', 'ç™ºä¿¡:ä¸å¿«', 'å—ä¿¡:å¿«', 'å—ä¿¡:ä¸å¿«', 'ç©ºæ°—æ„Ÿ', 'ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—', 'è²¢çŒ®(Doing)', 'å…±æœ‰(Being)']
    values = [q1, q2, q3, q4, q5, q6, q7, q8]
    values_radar = values + [values[0]]
    labels_radar = labels + [labels[0]]

    fig = go.Figure()
    fig.add_trace(go.Scatterpolar(
        r=values_radar, theta=labels_radar, fill='toself', name='Score',
        line_color='#FF4B4B', fillcolor='rgba(255, 75, 75, 0.2)'
    ))
    fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[0, 10])), showlegend=False)
    st.plotly_chart(fig, use_container_width=True)

    # --- æ·±å±¤è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ ---
    st.header("ğŸ“‹ Analysis Report")
    
    # ç·åˆã‚¹ã‚³ã‚¢
    total_score = sum(values)
    st.markdown(f"### Total Score: **{total_score}** / 80")

    # è¨ºæ–­çµæœã®å–å¾—
    results = analyze_results(q1, q2, q3, q4, q5, q6, q7, q8)
    
    if len(results) > 0:
        for res in results:
            # HTMLã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤º
            st.markdown(f"""
            <div class="report-box">
                <h4>{res['title']}</h4>
                <p>{res['text']}</p>
            </div>
            """, unsafe_allow_html=True)
    else:
        # ç‰¹å¾´çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãªã„å ´åˆã®æ±ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        st.info("ç‰¹ç­†ã™ã¹ããƒãƒ©ãƒ³ã‚¹ã®åã‚Šã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®å‡¹ã‚“ã§ã„ã‚‹éƒ¨åˆ†ãŒã€æ¬¡ã®ã€ŒäºŒäººã®ä¼¸ã³ä»£ã€ã§ã™ã€‚")

    # --- å¼·ã¿(è³‡ç”£)ã®ç™ºè¦‹ ---
    st.subheader("ğŸ’ Your Relationship Assets")
    assets = []
    if q1 >= 8: assets.append("ã‚ãªãŸã®ã€Œç´ ç›´ãªè¦æœ›ã€ã¯ã€äºŒäººã®é–¢ä¿‚ã‚’å‰ã«é€²ã‚ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚")
    if q3 >= 8: assets.append("ã‚ãªãŸã®ã€ŒèãåŠ›ã€ãŒã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®è‡ªä¿¡ã¨å®‰å¿ƒæ„Ÿã‚’æ”¯ãˆã¦ã„ã¾ã™ã€‚")
    if q5 >= 8: assets.append("ã‚ãªãŸãŒä½œã‚‹ã€Œç©ºæ°—æ„Ÿã€ã¯ã€äºŒäººã«ã¨ã£ã¦æœ€é«˜ã®å®‰å…¨åŸºåœ°ã§ã™ã€‚")
    if q8 >= 8: assets.append("ã€Œæ²ˆé»™ã‚’å…±æœ‰ã§ãã‚‹ã€ã“ã¨ã€‚ãã‚Œã¯é•·ç¶šãã™ã‚‹ã‚«ãƒƒãƒ—ãƒ«ã®æœ€å¤§ã®æ­¦å™¨ã§ã™ã€‚")
    
    if assets:
        for asset in assets:
            st.markdown(f'<div class="strength-box">âœ¨ {asset}</div>', unsafe_allow_html=True)